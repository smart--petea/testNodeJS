var sessions = {};
var sessionRegExp = /sessionId=(\d+)/;

/* exports */
module.exports.create = createSession;
module.exports.close = closeSession;
module.exports.isOpen = isOpen;

/* functions */
function createSession() {
	var sessionToken = new Date().getTime().toString();	
	sessions[sessionToken] = {};
	return sessionToken;
}

function isOpen(req, res) {
	var cookie = req.headers.cookie || "";
	var matches = cookie.match(sessionRegExp);

	/* if are session token in session all is ok and we continue */
	if(matches && matches.length > 1 && matches[1] in sessions)  return;

	/* if session token are not in sessions we redirect */

	res.writeHeader(301, {
		"Location": "/auth",
	});
	res.end();
}

function closeSession(req, res) {
	isOpen(sessionToken) && (delete sessions(sessionToken));
}
